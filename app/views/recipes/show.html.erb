<div class="container">
    <div class="row col-xs-12 col-md-6 col-md-offset-3" id="showContainer">
      <div class="showHeader">
          <% if @recipe != nil%>
            <h1>
              <%= @recipe.title  %>
            </h1>
            <%= image_tag @recipe.images%>
          <% else %>
            <h1>
              <%= @searchrecipe["title"] %>
            </h1>
            <%= image_tag @searchrecipe["image_url"] %>
          <% end %>
            <%#= cl_image_tag @recipe.image, :width=>300, :height=>300, :gravity=>"auto", :class => 'thumbnail' %>
            <div>
              <% if @recipe !=nil %>
                <ul>
                  <li>
                    <div class="row ratings col-xs-12 col-md-6 col-md-offset-3">
                      <%= form_tag(rate_path(@recipe), method: "post") do %>
                      <%# raise "help" %>
                      <% if current_user %>
                        <% if @ratings.size.eql?0 %>
                          I rate:<%= rating_for @recipe, "useful" %>
                          <script type="text/javascript">
                            $(document).ready(function() {
                              $('.raty-cancel').addClass('hidden');
                            });
                          </script>
                          <%= submit_tag("Rate") %>
                        <% else %>
                            My Rating:
                            <li id="recipe_rating">
                                <div class="wrapper">
                                 <div class="box" style="font-size:150%;color:gold;">&#9733</div>
                                 <div class="box" style="font-size:150%;color:gold;">&#9733</div>
                                 <div class="box" style="font-size:150%;color:gold;">&#9733</div>
                                 <div class="box" style="font-size:150%;color:gold;">&#9733</div>
                                 <div class="box" style="font-size:150%;color:gold;">&#9733</div>
                                </div>

                              <script  type="text/javascript">
                              var rating = ("<%= @recipe_rating %>") /5 ;

                              var width = 102 * rating;

                              $('#recipe_rating').width(width);
                              </script>
                            </li>
                        <% end %>
                      <% end %>
                      <% end %>
                    </div>
                    <div class="add_favorites">
                      <%= link_to '<span class="glyphicon glyphicon-bookmark" aria-hidden="true"></span>'.html_safe ,add_favorite_path %>
                    </div>
                  </li>
                  <li id="rating">Palate Rating:
                      <div class="wrapper">
                       <div class="box" style="font-size:150%;color:gold;">&#9733</div>
                       <div class="box" style="font-size:150%;color:gold;">&#9733</div>
                       <div class="box" style="font-size:150%;color:gold;">&#9733</div>
                       <div class="box" style="font-size:150%;color:gold;">&#9733</div>
                       <div class="box" style="font-size:150%;color:gold;">&#9733</div>
                      </div>

                    <script  type="text/javascript">
                    var rating = "<%= @recipe_avg_rating %>" / 5;

                    var width = 102 * rating;

                    $('#rating').width(width);
                    </script>
                  </li>
                  <% recipe_levels = {0=>'Easy',1=>'Medium',2=>'Complex'} %>
                  <li>Level: <%= recipe_levels[@recipe.level] %></li>
                  <% if @recipe.prep_duration %>
                  <li>Prep Time:<%= Time.at(@recipe.prep_duration).utc.strftime("%H:%M") %> Hrs.</li>
                  <% end %>
                  <% if @recipe.cook_duration %>
                  <li>Cook Time: <%= Time.at(@recipe.cook_duration).utc.strftime("%H:%M") %> Hrs.</li>
                  <% end %>
                  <li>Category: <%= @recipe.category %></li>
                  <li>Cuisine: <%= @recipe.cuisine %></li>
                  <li>Servines: <%= @recipe.servings %></li>
                </ul>
              <% else %>
              <ul>
                <li>Ratings: <% (@searchrecipe['ratings']).to_i.times do |i| %>
                  <span style="font-size:150%;color:gold;">&#9733;</span>
                <% end %></li>
                <li>Level: <%= @searchrecipe['level'] %></li>
                <% if ((@searchrecipe['prep_duration'][0]).to_i != 0) %>
                <li>Prep Time:<%= Time.at((@searchrecipe['prep_duration'][0]).to_i*60).utc.strftime("%H:%M")%> Hrs
                  <% if @searchrecipe['prep_duration'][1] %>  - <%=   Time.at((@searchrecipe['prep_duration'][1]).to_i*60).utc.strftime("%H:%M") %> Hrs.
                  <% end %>
                </li>
                <% end %>
                <% if (@searchrecipe['cook_duration']) %>
                <li>Cook Time: <%= Time.at((@searchrecipe['cook_duration'][0]).to_i*60).utc.strftime("%H:%M") %> Hrs.
                  <% if @searchrecipe['cook_duration'][1] %> - <%=   Time.at((@searchrecipe['cook_duration'][1]).to_i*60).utc.strftime("%H:%M") %> Hrs.
                  <% end %>
                </li>
                <% end %>
                <li>Servings: <%= @searchrecipe['servings'] %></li>
              </ul>
              <% end %>

            </div>

            <div id="ingredients">
              <h2>Ingredients</h2>
              <ul>
                <% if @recipe!=nil %>
                  <% @quantities.each do |q| %>
                    <li>
                      <%= q.size %>
                      <%= q.unit %>
                      <%= q.ingredient.name %>
                    </li>
                  <% end %>
                <% else %>
                    <% @searchrecipe["ingredients"].each do |i| %>
                    <li>
                      <%= i %>
                    </li>
                    <% end %>
                <% end %>
              </ul>

            </div>
            <!-- Nested ingredients -->
            <div id="directions">
              <% if @recipe != nil%>
                <h2>Directions</h2>
                <%= @recipe.directions %>
              <% else%>
                <h2>Directions</h2>
                <ul>
                  <% @searchrecipe['directions'].each_index do |i| %>
                    <li>
                      <%= @searchrecipe['directions'][i] %>
                    </li>
                  <% end %>
                </ul>
              <% end %>
            </div>
      </div>
      <%= button_to 'Delete' , recipe_path, :method=> 'delete',:data => {:confirm => "Are you sure"}%>
  </div>
</div>
